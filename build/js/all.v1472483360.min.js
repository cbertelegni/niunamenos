function MapChart(t){function a(t,a){var e=o.map.latLngToLayerPoint(new L.LatLng(a,t));this.stream.point(e.x,e.y)}var o=this;o.opts=t;var e={maxZoom:5,scrollWheelZoom:!1,touchZoom:!1,boxZoom:!1,continuousWorld:!0};o.tooltip=tooltipd3(),o.map=L.map(t.content,e).setView([32,-15],1);var n='Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>';L.tileLayer("https://{s}.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={token}",{id:"cbertelegni.i7iigf65",token:"pk.eyJ1IjoiY2JlcnRlbGVnbmkiLCJhIjoiY2lyd2R1eHI5MGoxdmZsbTg2dXNzbDV6YyJ9.Tywz28Zzyym3KGPrsFaalw",maxZoom:8,attribution:n}).addTo(o.map),o.map._initPathRoot();var r=d3.geo.transform({point:a});o.path=d3.geo.path().projection(r);var i=d3.select("#"+t.content).select("svg");o.g=i.append("g"),o.map.on("viewreset",function(){o.update()}),o.map.on("zoomlevelschange",function(){o.update()})}MapChart.prototype.pushData=function(t){function a(){this.on("mouseover",function(t){var a="<b>"+t.name+"</b><br>";a+="<b>Value:</b> "+t.total+"<br>",a+="<b>Quantity:</b> <br>",o.tooltip.mouseover(a)}).on("mousemove",o.tooltip.mousemove).on("mouseout",o.tooltip.mouseout)}var o=this;o.data=t.map(function(t){return t.loc=new L.LatLng(t.lat,t.lon),t}),o.scale_radio=d3.scale.linear().domain([0,d3.max(t,function(t){return t.total})]).range([3,20]),o.feature=o.g.selectAll(".circle").data(o.data),o.feature.enter().append("circle").attr("class",function(t){return["circle",t.name].join(" ")}).style("stroke","black").call(a),o.feature.exit().remove(),o.update()},MapChart.prototype.update=function(){var t=this;t.g.selectAll(".circle").style("fill","#36f").attr("transform",function(a){return"translate("+t.map.latLngToLayerPoint(a.loc).x+","+t.map.latLngToLayerPoint(a.loc).y+")"}).transition().attr("r",function(a){return t.scale_radio(a.total)}).attr("cx",function(a){return t.scale_radio(a.total)/2}).attr("cy",function(a){return t.scale_radio(a.total)/2}),t.update_bounding_map()},MapChart.prototype.update_bounding_map=function(){var t=this,a=t.data.map(function(t){return t.loc}),o=new L.LatLngBounds(a);return t.map.fitBounds(o),t.map.invalidateSize(),t};
var locs={"Buenos Aires":"-37.0660347,-64.5307909",Mendoza:"-34.7502062,-70.7873479","Santa Fe":"-31.1828675,-63.141691",Chubut:"-43.9748748,-70.1387829",CABA:"-34.615714, -58.5035323","Córdoba":"-32.226009,-66.0268798","Rio Negro":"-39.7690275,-69.5938478","Tucumán":"-27.0233033,-66.4440517","Entre Rios":"-32.0778416,-61.5371102","La Pampa":"-37.1397223,-68.0880544",Jujuy:"-23.1894535,-66.8202083","Neuquén":"-38.5598594,-72.2298438","Santiago del Estero":"-28.0419276,-65.6993844",Chaco:"-26.0193177,-63.1459822",Catamarca:"-27.5018226,-69.2055836",Corrientes:"-27.4860817,-58.8591269",Formosa:"-24.642852,-62.2030241","San Luis":"-33.9034943,-68.3840197",Misiones:"-26.8061156,-57.099474","Tierra del Fuego":"-53.8337145,-69.112786",Salta:"-24.7957076,-65.5710617","Ciudad Autónoma de Buenos Aires":"-34.6153711,-58.5737519","Entre Ríos":"-32.0731636,-61.5380363","La Rioja":"-29.8276818,-69.8076012","Río Negro":"-39.6951255,-71.8493843","San Juan":"-31.5316975,-68.5677823","Santa Cruz":"-49.0988388,-74.1563847"};$(function(){var a={content:"viz"},o=new MapChart(a);d3.csv("data/data.csv",function(a,n){n=_.groupBy(n,"Provincia");var t=[];for(var e in n)if("Exterior"!=e&&locs[e]){var r={name:e,data:n[e],total:n[e].length,lat:locs[e].split(",")[0],lon:locs[e].split(",")[1]};t.push(r)}o.pushData(t),o.update_bounding_map()})});