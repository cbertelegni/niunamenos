function BarChart(t,a){function e(t){o.data=t,o.scaleY.domain([0,d3.max(o.data,function(t){return t.total})]),o.bar=o.canvas.selectAll(".bar").data(o.data);var a=o.bar.enter().append("div").attr("class","bar").call(n);a.append("div").attr("class","bar_txt"),o.bar_label=o.canvas.selectAll(".bar_label").data(o.data),o.bar_label.enter().append("div").attr("class","bar_label"),o.bar.exit().remove(),o.bar_label.exit().remove(),r()}function n(){this.on("mouseover",function(t){var a="<b>"+t.name+"</b><br>";a+="<b>Cantidad: </b> "+t.total+"<br>",o.tooltip.mouseover(a)}).on("mousemove",o.tooltip.mousemove).on("mouseout",o.tooltip.mouseout)}function r(){var t=$(o.opts.content).width(),a=3;t=t/o.bar.data().length-a,o.bar.style("width",function(a,e){return t+"px"}).style("left",function(e,n){return(t+a)*n+a/2+"px"}).style("height",function(t,a){return o.scaleY(t.total)+"%"}).style("bottom",function(t,a){return"0px"}).style("background",function(t,a){return o.color_bars}),o.bar.select(".bar_txt").html(function(t){return""}),o.bar_label.html(function(t){return t.name}).style("width",function(a,e){return t+"px"}).style("left",function(e,n){return(t+a)*n+a/2+"px"})}var o=this;o.opts=a,o.color_bars="#1e6bb8",o.canvas=d3.select(a.content).append("div").attr("class","canvas_bar"),o.scaleY=d3.scale.linear().range([5,100]),o.tooltip=tooltipd3(),o.pushData=e,o.update=r,e(t)}
function MapChart(t){function o(t,o){var e=a.map.latLngToLayerPoint(new L.LatLng(o,t));this.stream.point(e.x,e.y)}var a=this;a.opts=t;var e={maxZoom:5,scrollWheelZoom:!1,touchZoom:!1,boxZoom:!1,continuousWorld:!0};a.tooltip=tooltipd3(),a.map=L.map(t.content,e).setView([32,-15],1);var n='Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>';L.tileLayer("https://{s}.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={token}",{id:"cbertelegni.i7iigf65",token:"pk.eyJ1IjoiY2JlcnRlbGVnbmkiLCJhIjoiY2lyd2R1eHI5MGoxdmZsbTg2dXNzbDV6YyJ9.Tywz28Zzyym3KGPrsFaalw",maxZoom:8,attribution:n}).addTo(a.map),a.map._initPathRoot();var r=d3.geo.transform({point:o});a.path=d3.geo.path().projection(r);var i=d3.select("#"+t.content).select("svg");a.g=i.append("g"),a.map.on("viewreset",function(){a.update()}),a.map.on("zoomlevelschange",function(){a.update()})}MapChart.prototype.pushData=function(t){function o(){this.on("mouseover",function(t){var o="<b>"+t.name+"</b><br>";o+="<b>Femicidios:</b> "+t.total+"<br>",a.tooltip.mouseover(o)}).on("mousemove",a.tooltip.mousemove).on("mouseout",a.tooltip.mouseout)}var a=this;a.data=t.map(function(t){return t.loc=new L.LatLng(t.lat,t.lon),t}),a.scale_radio=d3.scale.linear().domain([0,d3.max(t,function(t){return t.total})]).range([3,20]),a.feature=a.g.selectAll(".circle").data(a.data),a.feature.enter().append("circle").attr("class",function(t){return["circle",t.name].join(" ")}).style("stroke","black").call(o),a.feature.exit().remove(),a.update()},MapChart.prototype.update=function(){var t=this;t.g.selectAll(".circle").style("fill","#1e6bb8").attr("transform",function(o){return"translate("+t.map.latLngToLayerPoint(o.loc).x+","+t.map.latLngToLayerPoint(o.loc).y+")"}).transition().attr("r",function(o){return t.scale_radio(o.total)})},MapChart.prototype.update_bounding_map=function(){var t=this,o=t.data.map(function(t){return t.loc}),a=new L.LatLngBounds(o);return t.map.fitBounds(a),t.map.invalidateSize(),t};
var locs={"Buenos Aires":"-36.272988,-60.346513",CABA:"-34.615714, -58.5035323","Ciudad Autónoma de Buenos Aires":"-34.6153711,-58.5737519",Mendoza:"-33.837789,-68.557024","Santa Fe":"-29.773540, -60.690089",Chubut:"-43.89275,-68.579102","Córdoba":"-31.597581, -63.903979","Rio Negro":"-40.493018, -68.615712","Río Negro":"-40.493018, -68.615712","Tucumán":"-26.938320, -65.381922","Entre Rios":"-32.075015, -59.299457","Entre Ríos":"-32.075015, -59.299457","La Pampa":"-37.220522, -65.871430","La Rioja":"-29.631108, -67.135729",Jujuy:"-22.832761, -66.145428","Neuquén":"-38.600003, -70.058093","Santiago del Estero":"-27.703326, -63.466296",Chaco:"-26.618343, -60.664782",Catamarca:"-27.088818, -67.190661",Corrientes:"-28.729470, -57.775378",Formosa:"-24.777111, -60.159411","San Luis":"-33.861615, -66.081042",Misiones:"-26.936507, -54.580919","Tierra del Fuego":"-54.237850, -67.744698",Salta:"-25.204840, -64.805456","San Juan":"-31.099886, -68.881384","Santa Cruz":"-48.877868, -70.332708"};$(function(){var a={content:"viz"},r=new MapChart(a);d3.csv("data/data.csv",function(a,t){function e(){y.update(),B.update(),R.update(),A.update(),q.update()}var n=_.groupBy(t,"Provincia"),o=_.groupBy(t,"año"),u=_.groupBy(t,"porquienRegular"),i=_.groupBy(t,"comoRegular"),s=_.groupBy(t,"embarazada"),l=_.groupBy(t,"Mes"),d=[];for(var p in n)if("Exterior"!=p&&locs[p]){var v={name:p,data:n[p],total:n[p].length,lat:locs[p].split(",")[0],lon:locs[p].split(",")[1]};d.push(v)}r.pushData(d),r.update_bounding_map();var c=[];for(var h in o){var g={name:h,total:o[h].length,data:o[h]};c.push(g)}var m={content:"#by_year_bars"},B=new BarChart(c,m),C=[];for(var h in u){var g={name:h,total:u[h].length,data:u[h]};C.push(g)}var f={content:"#by_porquien"},y=new BarChart(C,f),b=[];for(var h in i){var g={name:h,total:i[h].length,data:i[h]};b.push(g)}var w={content:"#comoRegular",axis:"value"},R=new BarChart(b,w),z=[];for(var h in s){var g={name:h,total:s[h].length,data:s[h]};z.push(g)}var S={content:"#embarazada"},A=new BarChart(z,S),E=[];for(var h in l){var g={name:h,total:l[h].length,data:l[h]};E.push(g)}var M,T={content:"#mes"},q=new BarChart(E,T);window.onresize=function(a){clearTimeout(M),M=setTimeout(e,200)}})});