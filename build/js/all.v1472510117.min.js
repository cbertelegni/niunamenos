function BarChart(t,a){function e(t){o.data=t,o.scaleY.domain([0,d3.max(o.data,function(t){return t.total})]),o.bar=o.canvas.selectAll(".bar").data(o.data);var a=o.bar.enter().append("div").attr("class","bar").call(n);a.append("div").attr("class","bar_txt"),o.bar_label=o.canvas.selectAll(".bar_label").data(o.data),o.bar_label.enter().append("div").attr("class","bar_label"),o.bar.exit().remove(),o.bar_label.exit().remove(),r()}function n(){this.on("mouseover",function(t){var a="<b>"+t.name+"</b><br>";a+="<b>Cantidad: </b> "+t.total+"<br>",o.tooltip.mouseover(a)}).on("mousemove",o.tooltip.mousemove).on("mouseout",o.tooltip.mouseout)}function r(){var t=$(o.opts.content).width(),a=3;t=t/o.bar.data().length-a,o.bar.style("width",function(a,e){return t+"px"}).style("left",function(e,n){return(t+a)*n+a/2+"px"}).style("height",function(t,a){return o.scaleY(t.total)+"px"}).style("bottom",function(t,a){return"0px"}).style("background",function(t,a){return o.color_bars}),o.bar.select(".bar_txt").html(function(t){return""}),o.bar_label.html(function(t){return t.name}).style("width",function(a,e){return t+"px"}).style("left",function(e,n){return(t+a)*n+a/2+"px"})}var o=this;o.opts=a,o.color_bars="#1e6bb8",o.canvas=d3.select(a.content).append("div").attr("class","canvas_bar"),o.scaleY=d3.scale.linear().range([0,100]),o.tooltip=tooltipd3(),o.pushData=e,e(t)}
function MapChart(t){function o(t,o){var e=a.map.latLngToLayerPoint(new L.LatLng(o,t));this.stream.point(e.x,e.y)}var a=this;a.opts=t;var e={maxZoom:5,scrollWheelZoom:!1,touchZoom:!1,boxZoom:!1,continuousWorld:!0};a.tooltip=tooltipd3(),a.map=L.map(t.content,e).setView([32,-15],1);var n='Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>';L.tileLayer("https://{s}.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={token}",{id:"cbertelegni.i7iigf65",token:"pk.eyJ1IjoiY2JlcnRlbGVnbmkiLCJhIjoiY2lyd2R1eHI5MGoxdmZsbTg2dXNzbDV6YyJ9.Tywz28Zzyym3KGPrsFaalw",maxZoom:8,attribution:n}).addTo(a.map),a.map._initPathRoot();var r=d3.geo.transform({point:o});a.path=d3.geo.path().projection(r);var i=d3.select("#"+t.content).select("svg");a.g=i.append("g"),a.map.on("viewreset",function(){a.update()})}MapChart.prototype.pushData=function(t){function o(){this.on("mouseover",function(t){var o="<b>"+t.name+"</b><br>";o+="<b>Femicidios:</b> "+t.total+"<br>",a.tooltip.mouseover(o)}).on("mousemove",a.tooltip.mousemove).on("mouseout",a.tooltip.mouseout)}var a=this;a.data=t.map(function(t){return t.loc=new L.LatLng(t.lat,t.lon),t}),a.scale_radio=d3.scale.linear().domain([0,d3.max(t,function(t){return t.total})]).range([3,20]),a.feature=a.g.selectAll(".circle").data(a.data),a.feature.enter().append("circle").attr("class",function(t){return["circle",t.name].join(" ")}).style("stroke","black").call(o),a.feature.exit().remove(),a.update()},MapChart.prototype.update=function(){var t=this;t.g.selectAll(".circle").style("fill","#1e6bb8").attr("transform",function(o){return"translate("+t.map.latLngToLayerPoint(o.loc).x+","+t.map.latLngToLayerPoint(o.loc).y+")"}).transition().attr("r",function(o){return t.scale_radio(o.total)}).attr("cx",function(o){return t.scale_radio(o.total)/2}).attr("cy",function(o){return t.scale_radio(o.total)/2})},MapChart.prototype.update_bounding_map=function(){var t=this,o=t.data.map(function(t){return t.loc}),a=new L.LatLngBounds(o);return t.map.fitBounds(a),t.map.invalidateSize(),t};
var locs={"Buenos Aires":"-37.0660347,-64.5307909",Mendoza:"-34.7502062,-70.7873479","Santa Fe":"-31.1828675,-63.141691",Chubut:"-43.9748748,-70.1387829",CABA:"-34.615714, -58.5035323","Córdoba":"-32.226009,-66.0268798","Rio Negro":"-39.7690275,-69.5938478","Tucumán":"-27.0233033,-66.4440517","Entre Rios":"-32.0778416,-61.5371102","La Pampa":"-37.1397223,-68.0880544",Jujuy:"-23.1894535,-66.8202083","Neuquén":"-38.5598594,-72.2298438","Santiago del Estero":"-28.0419276,-65.6993844",Chaco:"-26.0193177,-63.1459822",Catamarca:"-27.5018226,-69.2055836",Corrientes:"-27.4860817,-58.8591269",Formosa:"-24.642852,-62.2030241","San Luis":"-33.9034943,-68.3840197",Misiones:"-26.8061156,-57.099474","Tierra del Fuego":"-53.8337145,-69.112786",Salta:"-24.7957076,-65.5710617","Ciudad Autónoma de Buenos Aires":"-34.6153711,-58.5737519","Entre Ríos":"-32.0731636,-61.5380363","La Rioja":"-29.8276818,-69.8076012","Río Negro":"-39.6951255,-71.8493843","San Juan":"-31.5316975,-68.5677823","Santa Cruz":"-49.0988388,-74.1563847"};$(function(){var a={content:"viz"},t=new MapChart(a);d3.csv("data/data.csv",function(a,o){data=_.groupBy(o,"Provincia"),data_by_year=_.groupBy(o,"año");var r=[];for(var e in data)if("Exterior"!=e&&locs[e]){var n={name:e,data:data[e],total:data[e].length,lat:locs[e].split(",")[0],lon:locs[e].split(",")[1]};r.push(n)}t.pushData(r),t.update_bounding_map();var i=[];for(var s in data_by_year){var u={name:s,total:data_by_year[s].length,data:data_by_year[s]};i.push(u)}var d={content:"#by_year_bars",axis:"value",division:1e6};new BarChart(i,d)})});